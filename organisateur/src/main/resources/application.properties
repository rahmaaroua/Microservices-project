# =========================
# Microservice configuration
# =========================
spring.application.name=organisateur-service
server.port=8084

# =========================
# Database configuration
# =========================
spring.datasource.url=jdbc:mysql://localhost:3306/organisateur_db?useSSL=false&serverTimezone=UTC
spring.datasource.username=root
spring.datasource.password=0000
spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver

# Hibernate dialect
spring.jpa.database-platform=org.hibernate.dialect.MySQLDialect
spring.jpa.show-sql=true
spring.jpa.hibernate.ddl-auto=update

# =========================
# Eureka client configuration
# =========================
eureka.client.service-url.defaultZone=http://localhost:8761/eureka/
eureka.client.register-with-eureka=true
eureka.client.fetch-registry=true
eureka.instance.prefer-ip-address=true

# =========================
# AXON CONFIGURATION
# =========================
# Axon Server URL (si vous utilisez Axon Server dans Docker)
axon.axonserver.servers=localhost:8124

# Event Store Configuration (utilise MySQL)
axon.eventhandling.processors.*.mode=tracking
axon.eventhandling.processors.*.source=eventStore
axon.eventhandling.processors.*.initial-segment-count=1

# Stockage des événements dans MySQL
axon.eventstore.jpa.schema-generation.enabled=true

# ===========================
# RESILIENCE4J
# ===========================

# Circuit Breaker
resilience4j.circuitbreaker.instances.evenementCB.register-health-indicator=true
resilience4j.circuitbreaker.instances.evenementCB.sliding-window-size=10
resilience4j.circuitbreaker.instances.evenementCB.minimum-number-of-calls=5
resilience4j.circuitbreaker.instances.evenementCB.failure-rate-threshold=50
resilience4j.circuitbreaker.instances.evenementCB.wait-duration-in-open-state=30s
resilience4j.circuitbreaker.instances.evenementCB.permitted-number-of-calls-in-half-open-state=3
resilience4j.circuitbreaker.instances.evenementCB.automatic-transition-from-open-to-half-open-enabled=true

# Retry
resilience4j.retry.instances.evenementRetry.max-attempts=3
resilience4j.retry.instances.evenementRetry.wait-duration=1s

# Rate Limiter - CRUD endpoints (strict pour test)
resilience4j.ratelimiter.instances.crudRateLimiter.limit-for-period=5
resilience4j.ratelimiter.instances.crudRateLimiter.limit-refresh-period=1s
resilience4j.ratelimiter.instances.crudRateLimiter.timeout-duration=0s

# Rate Limiter - Evenement endpoints (permissif)
resilience4j.ratelimiter.instances.evenementRateLimiter.limit-for-period=100
resilience4j.ratelimiter.instances.evenementRateLimiter.limit-refresh-period=1s
resilience4j.ratelimiter.instances.evenementRateLimiter.timeout-duration=0s

# ===========================
# ACTUATOR & MONITORING
# ===========================
management.endpoints.web.exposure.include=*
management.endpoint.health.show-details=always
management.metrics.export.prometheus.enabled=true
management.health.circuitbreakers.enabled=true
management.health.ratelimiters.enabled=true